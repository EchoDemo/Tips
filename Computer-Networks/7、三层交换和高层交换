1、三层交换：

    (1)二层交换机的二层数据交换一般都是使用ASIC（Application Specific Integrated Circuit ，专用集成电路）的硬件芯片中的CAM表来实现的，因为是硬件转发，
    
所以转发性能非常高。而三层交换机的三层转发也是依靠ASIC芯片完成的（路由器的路由功能主要依靠CPU软件进行的），但其中除了二层交换用的CAM表外，还保存有专门

用于三层转发的三层硬件转发表。

    (2)三层交换机的三层交换原理比较复杂，不同网络环境下、不同厂家的三层交换机的三层交换流程都不完全相同。
       a、源主机在发起通信之前，将自己的IP地址与目的主机的IP地址进行比较，如果源主机判断目的主机与自己位于不同网段时，它需要通过网关来递交报文的，所以它
        
       首先需要通过一个ARP请求报文获取网关的MAC地址（在源主机不知道网关MAC地址的情形下），即源主机先发送ARP请求帧以获取网关IP地址对应的MAC地址。
        
       b、网关在收到源主机发来的ARP请求报文后以一个ARP应答报文进行回应，在应答报文中的“源MAC地址”就包含了网关的MAC地址。
       
       c、在得到网关的ARP应答后，源主机再用网关MAC地址作为报文的“目的MAC地址”，以源主机的IP地址作为报文的“源IP地址”，以目的主机的IP地址作为“目的IP地址”，
       
       先把发送给目的主机的数据发给网关。
       
       d、网关在收到源主机发送给目的主机的数据后，由于查看得知源主机和目的主机的IP地址不在同一网段，于是把数据报上传到三层交换引擎（ASIC芯片），
       
       在里面查看有无目的主机的三层转发表。
       
       e、如果在三层硬件转发表中没有找到目的主机的对应表项，则向CPU请求查看软件路由表，如果有目的主机所在网段的路由表项，则还需要得到目的主机的MAC地址，
       
       因为数据包在链路层是要经过帧封装的。于是三层交换机CPU向目的主机所在网段发送一个ARP广播请求包，以获得目的主机MAC地址。
       
       f、交换机获得目的主机MAC地址后，向ARP表中添加对应的表项，并转发由源主机到达目的主机的灵气包。同时三层交换机三层引擎会结合路由表生成目的主机的三层
       
       硬件转发表。
       

       以后到达目的主机的数据包就可以直接利用三层硬件转发表中的转发表项进行数据交换，不用再查看CPU中的路由表了。以上流程适用位于不同VLAN（网段）中的主机
       
       互访时属于这种情况，这时用于互连的交换机作三层交换转发。这就是“一次路由，多次交换”的原理。
       
       
2、第四层交换：

    网络层以上也就是第四层即传输层，传输层主要负责端对端的通信。传输层有很多的协议，常用的有TCP、UDP协议，这些协议承载了许多不同的业务，这些业务通常

是由一些诸如HTTP、FTP、NFS、Telnet等协议表示，这些协议的类型由TCP或UDP端口地址来决定，就如同第二层的传输是依靠MAC地址来寻址，第三层的传输是依靠

IP地址来寻址，那么第四层的主要表示就是传输层的端口地址。通过端口地址可以区分数据包是由哪个传输层协议传送的。分配端口号的清单可以在RFC1700中找到。

TCP／UDP端口号提供的附加信息可以为网络交换机所利用，这是第四层交换的基础。


　　第四层交换中数据包的传输不仅仅依据MAC地址(第二层交换)或源/目标IP地址(第三层路由),还依据TCP/UDP端口地址(第四层地址)，也就是说第四层交换除了考虑
  
三层的逻辑地址外还要考虑对端口地址的处理。如同上面所描述的那样，端口地址代表了不同的业务协议，所以第四层交换不仅仅进行了物理上的交换，还包括了业务上的

交换。所以说第四层交换的交换域是由源端和终端IP地址、TCP和UDP端口共同决定。因此，第四层交换机是真正的“会话交换机”。


　　由于带有业务信息，所以第四层交换机就带有了业务智能，可以做出向何处转发会话传输流的决定。对于Internet服务提供商或内容提供商来说，第四层交换的这个
  
功能是尤其重要的。不断增长的负荷和需求的出现，使得用单台服务器处理应用服务的结构已成为过去，一般网络的服务提供商采用多种不同系统来构架一种应用的大型

企业数据中心，数据在很多服务器上进行镜像复制。第四层交换在这样的情况下是大有可为的，可以将会话转入性能最佳的目的机器上。


　　第四层交换尤其可以应用在以单一虚拟IP地址(VIP)来代表整个服务器集群的情况下。具有第四层功能的交换机能够起到与服务器相连接的"虚拟IP"(VIP)前端的作用。每
  
台服务器和支持单一或通用应用的服务器组都配置同样的一个VIP地址。这个VIP地址作为对外提供统一服务的目的地。当某用户申请应用时，用户请求的数据包先通过第三

层路由器发送到具有第四层交换功能的交换机，然后第四层交换机可以根据会话和应用层信息做出转发决定，将用户的请求根据不同的规则转发到"最佳"的服务器上。将"最

佳"服务器地址中的IP取代VIP，并将连接请求传给相应服务器。因此，第四层交换技术是用于传输数据和实现多台服务器间负载均衡的理想机制。


　　第四层交换技术通过硬件来实现可以做成第四层交换机，它可以实现基于端到端的服务质量要求对所有联网设备的负载进行细致的均衡，以保证客户机与服务器之间数
  
据平滑地流动。


　　第四层交换技术的关键问题是如何确定传输流转发给哪台最可用的服务器，也就是策略选择问题。选择策略可以根据不同的需要来制定，对高优先权的业务应首先保证
  
它的QoS，将这种业务引向最大可利用的服务器中。而QoS要求小的就可以作为一般负载处理。目前应用神经网络的学习算法实现在学习中动态的调整策略是一种非常好的实

现方法。


3、应用交换技术：
   在第四层交换大大地提高了网络性能和QoS保证之后，在更高的层次上也引入了交换的概念，可以称之为第七层交换技术，或者高层智能交换。
   
这时候的交换突破了一般意义上的交换的概念，开始进入以进程和内容级别为主的交换范围。高层由于和应用相关，我们说这时候的交换就有了智能性。交换机具有了区别

各种高层的应用和识别内容的能力。这时的交换机不仅能根据数据包的IP地址或者端口地址来传送数据，而且还能打开数据包，进入数据包内部并根据包中的信息做出负载

均衡、内容识别等判断。


　　对于某一个端口来说，我们在第四层交换时候可以对端口进行分析来获得较好的QoS，但是对于通过TCP/IP端口的传输流我们没有办法识别，只能对所有属于这个端口
  
的传输流统一对待，而服务提供商或许需要其中的某些传输流具有高的QoS优先处理权或者将某些流引向性能高的处理机中。而第七层的智能交换能够实现进一步的控制，

即对所有传输流和内容的控制。这种交换机可以打开传输流的应用／表示层，分析其中的内容，因此可以根据应用的类型而非仅仅根据IP和端口号做出更智能的流向决策。

其中的一个典型例子就是根据URL的具体内容的识别交换。


　　第七层交换技术可以定义为数据包的传送不仅仅依据MAC地址(第二层交换)或源/目标IP地址(第三层路由)以及依据TCP/UDP端口(第四层地址)，而是可以根据内容
  
(表示/应用层)进行。这样的处理更具有智能性，交换的不仅仅是端口，还包括了内容，因此，第七层交换机是真正的"应用交换机"。


　　这类具有第七层认知的交换机可以应用在很多方面，比如保证不同类型的传输流被赋予不同的优先级。它可以对传输流进行过滤并分配优先级，使你不必依赖于业务或
  
网络设备来达到这些目的，譬如，网络电子商务提供商使用80端口提供用户服务，但是对于不同的Web请求他们希望不同对待，比如浏览一般商品的Web请求的级别比用户发

出的定购Web请求要低一些，而且处理起来也不一样。这样需要识别80端口中的具体的URL内容来进行判断，赋予不同的优先权交换到不同的处理器上去。更进一步,可能需

要对不同级别的用户的Web请求给予不同QoS优先权，这样就需要对数据请求的内容进行识别，这时候对交换的智能要求就非常高了。


　　目前关于第七层交换功能还没有具体的标准。第七层交换功能和目前很多类似的技术具有很大的互补性，它可以和其他的网络服务和谐地共存。但是第七层交换和类似
  
的解决方案之间最大的优势，也就是交换技术具有的最大优势，就是高速而且不影响智能处理。采用第七层交换技术可以以交换的线速度做出更智能性的传输流内容的决策。

用户将自由地根据得到的信息就各类传输流和其目的地做出决策，从而优化网络访问，为最终用户提供更好的服务。


4、高层交换技术与Web交换机：
　　高层交换技术的一个典型应用就是Web交换机。目前Internet网上提供应用的主要方式就是网站，在网站上的信息量和访问量急剧增长的前提下，怎样为用户提供更多
  
的服务，使每个用户都可以得到QoS保证是一个越来越重要的问题。网站的运营商们正在尝试通过架构新的体系结构以适应其业务的增长。


　　怎样将数据中心的各种设备，包括各种互联网服务器、防火墙、高速缓冲服务器、数据仓库和网关等组织起来提供对外界面一致和QoS保证的服务，同时提供管理、
  
路由和负载均衡传输成为一个焦点问题。所以必须提供一种处于网络中心地位的交换机，来组织数据中心，我们称之为Web交换机，Web交换机的基本功能是：


· 组织数据中心；
· 提供对外一致的服务界面；
· 管理数据的流向、路由；
· 负载均衡；
· 提供QoS和CoS(服务等级)；
· 请求会话定向。


　　可以看出所需要的Web交换技术仅仅用传统的交换机是无法实现的，必须结合高层交换机的技术来实现。为了实现上述的功能Web交换机必须检查4~7层的协议字段，
  
获取信息来处理数据流的管理和定向。Web交换机的设计比较复杂，目前Web交换机也只是采用了三层以上的高层交换技术的部分功能。主要的Web交换机设计方案有三种：

集中式CPU模式、分布式处理系统和二级混合模式。每种设计方案是采用不同的方法把交换、控制和状态共享组合，因此各有优缺点。



